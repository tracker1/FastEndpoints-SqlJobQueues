# [MyApp].[JobQueue]

Active jobs waiting to be processed or currently in progress.

## Purpose

This table holds jobs that are pending, in-progress, or recently failed and awaiting retry. Jobs are moved to `JobHistory` upon completion or cancellation to keep this table small for fast query performance.

## Columns

| Column | Type | Default | Description |
|--------|------|---------|-------------|
| QueueID | VARCHAR(255) | - | Queue/command name identifier (auto-generated by FastEndpoints) |
| TrackingID | UNIQUEIDENTIFIER | - | Primary key, unique job identifier |
| WorkCommandJson | VARCHAR(MAX) | `{}` | Serialized job command/parameters |
| WorkResultJson | VARCHAR(MAX) | `{}` | Serialized job result (updated during processing) |
| WorkLogJsonLines | VARCHAR(MAX) | `''` | Newline-separated JSON log entries |
| Tries | INT | `0` | Number of execution attempts |
| ExecuteAfter | DATETIME | - | Earliest time to start the job |
| ExpireOn | DATETIME | - | Auto-cancel if not completed by this time |
| IsComplete | BIT | `0` | Completion flag |
| IsCancelled | BIT | `0` | Cancellation flag |
| StartedOn | DATETIME | NULL | When job execution started |
| FinishedOn | DATETIME | NULL | When job execution finished |
| CreatedOn | DATETIME | `SYSUTCDATETIME()` | Record creation timestamp |
| CreatedByUserId | VARCHAR(100) | `'SYSTEM'` | User ID who created the job |
| CreatedByDisplayName | VARCHAR(255) | `'System'` | Display name of creator |

## Indexes

- Primary key on `TrackingID`
- Query optimization for pending jobs: `WHERE StartedOn IS NULL AND ExecuteAfter <= @now`

## Lifecycle

1. Job created with `StartedOn = NULL`
2. Job picked up for processing: `StartedOn` set
3. On success: moved to `JobHistory` with `IsComplete = 1`
4. On failure: `StartedOn` reset, `Tries` incremented, `ExecuteAfter` delayed
5. On expiration: moved to `JobHistory` with `IsCancelled = 1`
